---
title: День 1. Пентест Windows
tags: innoctf-junior-2019
---
# Пентест. Windows
Пентест винды должен быть целевым.
## Цели
- Сама машина как цель
- Машина как промежуточное звено

## Схема атаки
1. Исполнять код на машине
    - Запилить более простой бэкдор
2. Поднять привелеги

## Руткиты
- Самостоятельно (долго)
- Metasploit Framework *(msfvenom)*
    - Записывает рутки в какой-либо процесс в память
    - **Meterpreter** -- пилит удобный shell вместо дефолтногоcm
    - Shells
        - `Bind-Shell` -- простой шелл, который крутится на каком-либо порту и к которому надо биндиться
        - `Reverse-Shell` -- шелл, который сам подключается к вашей машине
- `migrate` -- команда, позволяющая ходить между процессами
    
## Доставка руткита
### Физический доступ
- Подходим, загружаем руткит, уходит
### Сетевой досуп
#### Сканнеры уязвимостей
- Модуль `auxiliary/scanner` в *MetaSploit*
- `OpenVAS`

#### Обращение с системой
- `bind` -- открывается порт, к нему подключается пентестер
- `reverse` -- уязвимая машина сама подключается на указанный IP-адрес

## Повышение привелегий
1. `getsystem` -- скрипт, который обычно повышает привелегии
2. `exploit/windows/local/...` -- эксплоиты для повышения привелегий

## Непосредственно после входа в систему
1. `ps.exe` -- смотрим имеющиеся процессы и их PID-ы
2. `migrate explorer.exe` -- прикрепляемся к `explorer.exe`, дабы процесс не помер

## Получение паролей пользователей
- `hashdump` -- хэши локальных пользователей
- `mimikatz` -- если нет meterpreter-а
    1. Догружаем mimikatz
    2. `load kiwi`
    3. `kiwi_exec_md <mimikatz>`

## Если машина сдохла
**Volatility** -- утилита для работы с дампом ОЗУ

